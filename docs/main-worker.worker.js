(()=>{"use strict";var e,t={748:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getRandomId=void 0,t.getRandomId=function(){return Math.random().toString()}},733:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getDo=void 0;var r=n(748);t.getDo=function(e){var t=e.conversations,n=e.worker;return function(e,o){return new Promise((function(a,i){var s=(0,r.getRandomId)(),l={id:s,resolve:a,reject:i};t[l.id]=l;var c={type:"do",id:s,command:e,data:o};n?n.postMessage(c):postMessage(c)}))}}},117:function(e,t){var n=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},r=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.getDoMessageHandler=void 0,t.getDoMessageHandler=function(e){var t=e.onHandlers,o=e.worker;return function(e){var a=e.id,i=e.command,s=e.data;return n(void 0,void 0,void 0,(function(){var e,n,l,c;return r(this,(function(r){switch(r.label){case 0:return r.trys.push([0,2,,3]),t[i]?(c={type:"answer",id:a},[4,t[i](s)]):(e={type:"error",id:a,data:new Error("unknown command received: ".concat(i))},o?(o.postMessage(e),[2]):(postMessage(e),[2]));case 1:return c.data=r.sent(),l=c,o?(o.postMessage(l),[2]):(postMessage(l),[3,3]);case 2:return n=r.sent(),l={type:"error",id:a,data:n},o?(o.postMessage(l),[2]):(postMessage(l),[3,3]);case 3:return[2]}}))}))}}},69:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getMessageHandlers=void 0;var r=n(117),o=n(102);t.getMessageHandlers=function(e){var t=e.conversations,n=e.onHandlers,a=e.worker,i=e.parentPort;return{do:(0,r.getDoMessageHandler)({onHandlers:n,worker:a||i}),answer:(0,o.getResponseMessageHandler)({handlerKey:"resolve",conversations:t}),error:(0,o.getResponseMessageHandler)({handlerKey:"reject",conversations:t})}}},588:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getOn=void 0,t.getOn=function(e){var t=e.onHandlers;return function(e,n){return t[e]=n}}},102:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.getResponseMessageHandler=void 0,t.getResponseMessageHandler=function(e){var t=e.handlerKey,n=e.conversations;return function(e){var r=e.id,o=e.data,a=n[r];delete n[r],a[t](o)}}},217:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.setOnmessage=void 0,t.setOnmessage=function(e){var t=e.messageHandlers,n=e.worker,r=e.nodeWorker,o=e.parentPort,a=function(e){var n=e.data,r=n.type;t[r](n)};n?n.onmessage=a:r?r.on("message",(function(e){return a({data:e})})):o?o.addListener("message",(function(e){return a({data:e})})):onmessage=a}},255:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.WorkerApi=void 0;var r=n(733),o=n(588),a=n(69),i=n(217);t.WorkerApi=function(e){var t=void 0===e?{}:e,n=t.worker,s=t.parentPort,l=t.nodeWorker;this.conversations={},this.onHandlers={},this.messageHandlers=(0,a.getMessageHandlers)({conversations:this.conversations,onHandlers:this.onHandlers,worker:n,parentPort:s}),(0,i.setOnmessage)({messageHandlers:this.messageHandlers,worker:n,nodeWorker:l,parentPort:s}),this.do=(0,r.getDo)({conversations:this.conversations,worker:n||l||s}),this.on=(0,o.getOn)({onHandlers:this.onHandlers}),this.worker=n||l||null,this.parentPort=s||null}},662:function(e,t){var n=this&&this.__assign||function(){return n=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},n.apply(this,arguments)},r=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},o=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.processDbUpdateResult=t.getDbUpdate=t.localDb=void 0;var a,i={users:{indexes:{name:{keyPath:"name",options:{unique:!0}}}},games:{indexes:{players:{keyPath:["wPlayer","bPlayer"],options:{unique:!1}}}},fens:{indexes:{gameAndIndex:{keyPath:["game","index"],options:{unique:!1}}}}},s={id:{keyPath:"id",options:{unique:!0}},updateId:{keyPath:"updateId",options:{unique:!1}}},l=Object.keys(i).reduce((function(e,t){return e[t]={indexes:n(n({},s),i[t].indexes)},e}),{}),c=[],u=function(){return new Promise((function(e){if(a)return e(a);c.push(e)}))},f=indexedDB.open("chss-db",10);f.onupgradeneeded=function(e){var t=e.target.result;Object.keys(l).forEach((function(e){t.objectStoreNames.contains(e)&&t.deleteObjectStore(e);var n=l[e],r=n.keyPath,o=void 0===r?"id":r,a=n.indexes,i=void 0===a?s:a,c=t.createObjectStore(e,{keyPath:o});Object.keys(i).forEach((function(e){c.createIndex(e,i[e].keyPath,i[e].options)}))}))},f.onsuccess=function(e){for(a=e.target.result;c.length;)c.pop()(a)},f.onerror=function(e){console.error("Error opening database",e.target.error)};var d=function(){function e(e){var t=e.storeName;this.storeName=t}return e.prototype.findAll=function(e){var t=this;return new Promise((function(n,a){return r(t,void 0,void 0,(function(){var t,r,i,c,f,d,h,g,v=this;return o(this,(function(o){switch(o.label){case 0:return[4,u()];case 1:if(t=o.sent().transaction([this.storeName],"readonly"),r=t.objectStore(this.storeName),!(i=Object.keys(l[this.storeName].indexes||s).find((function(t){return Object.keys(e).reduce((function(e,n){return e&&[].concat((l[v.storeName].indexes||s)[t].keyPath).includes(n)}),!0)}))))throw new Error("couldn't find suitable index in ".concat(this.storeName," for condition ").concat(JSON.stringify(e)));return c=r.index(i),f=[].concat((l[this.storeName].indexes||s)[i].keyPath).map((function(t){return e[t]||""})),d=IDBKeyRange.only(f.length>1?f:f[0]),h=c.openCursor(d),g=[],h.onsuccess=function(t){var r=t.target.result;if(r)g.push(r.value),r.continue();else{var o=g.filter((function(t){return Object.keys(e).reduce((function(n,r){return n&&e[r]===t[r]}),!0)}));n(o)}},h.onerror=function(e){return a(e)},[2]}}))}))}))},e.prototype.insert=function(e){var t=this;return new Promise((function(a,i){return r(t,void 0,void 0,(function(){var t,r,s,l=this;return o(this,(function(o){switch(o.label){case 0:return[4,u()];case 1:return t=o.sent().transaction([this.storeName],"readwrite"),r=t.objectStore(this.storeName),(s=r.add(n(n({},e),e.updateId?{}:{updateId:"pending"}))).onsuccess=function(e){a(e)},s.onerror=function(t){var n=t.target.error;console.error("Error writing to ".concat(l.storeName," indexedDB store."),n,{data:e}),i(n)},[2]}}))}))}))},e.prototype.update=function(e){var t=this;return new Promise((function(n,a){return r(t,void 0,void 0,(function(){var t,r,i,s=this;return o(this,(function(o){switch(o.label){case 0:return[4,u()];case 1:return t=o.sent().transaction([this.storeName],"readwrite"),r=t.objectStore(this.storeName),(i=r.put(e)).onsuccess=function(e){n(e)},i.onerror=function(t){var n=t.target.error;console.error("Error processing update in ".concat(s.storeName," indexedDB store."),n,{data:e}),a(n)},[2]}}))}))}))},e}();t.localDb=Object.keys(l).reduce((function(e,t){return e[t]=new d({storeName:t}),e}),{}),t.getDbUpdate=function(){return r(void 0,void 0,void 0,(function(){var e,n,r,a,i;return o(this,(function(o){switch(o.label){case 0:e={},n=0,r=Object.keys(t.localDb),o.label=1;case 1:return n<r.length?(a=r[n],[4,t.localDb[a].findAll({updateId:"pending"})]):[3,4];case 2:(i=o.sent())&&i.length&&(e[a]={add:i}),o.label=3;case 3:return n++,[3,1];case 4:return[2,e]}}))}))},t.processDbUpdateResult=function(e){var a=e.dbUpdate,i=e.updateResult;return r(void 0,void 0,void 0,(function(){var e,r,s,l,c,u,f;return o(this,(function(o){switch(o.label){case 0:if(!a||!i)return[2];e=i.updateIds,r=0,s=Object.keys(e),o.label=1;case 1:if(!(r<s.length))return[3,6];l=s[r],c=0,u=a[l].add,o.label=2;case 2:return c<u.length?(f=u[c],[4,t.localDb[l].update(n(n({},f),{updateId:e[l]}))]):[3,5];case 3:o.sent(),o.label=4;case 4:return c++,[3,2];case 5:return r++,[3,1];case 6:return[2]}}))}))}},890:(e,t)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.catchErrors=void 0,t.catchErrors=function(e){var t=e.logger;self.addEventListener("error",(function(e){var n,r;t({type:"error",message:(e.message||(null===(n=e.error)||void 0===n?void 0:n.message))+1,stack:null===(r=e.error)||void 0===r?void 0:r.stack,filename:e.filename,lineno:e.lineno,colno:e.colno})})),self.addEventListener("unhandledrejection",(function(e){t({type:"error",message:e.reason.message,stack:e.reason.stack})}))}},763:function(e,t,n){var r=this&&this.__assign||function(){return r=Object.assign||function(e){for(var t,n=1,r=arguments.length;n<r;n++)for(var o in t=arguments[n])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e},r.apply(this,arguments)},o=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,a){function i(e){try{l(r.next(e))}catch(e){a(e)}}function s(e){try{l(r.throw(e))}catch(e){a(e)}}function l(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(i,s)}l((r=r.apply(e,t||[])).next())}))},a=this&&this.__generator||function(e,t){var n,r,o,a,i={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(s){return function(l){return function(s){if(n)throw new TypeError("Generator is already executing.");for(;a&&(a=0,s[0]&&(i=0)),i;)try{if(n=1,r&&(o=2&s[0]?r.return:s[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,s[1])).done)return o;switch(r=0,o&&(s=[2&s[0],o.value]),s[0]){case 0:case 1:o=s;break;case 4:return i.label++,{value:s[1],done:!1};case 5:i.label++,r=s[1],s=[0];continue;case 7:s=i.ops.pop(),i.trys.pop();continue;default:if(!((o=(o=i.trys).length>0&&o[o.length-1])||6!==s[0]&&2!==s[0])){i=0;continue}if(3===s[0]&&(!o||s[1]>o[0]&&s[1]<o[3])){i.label=s[1];break}if(6===s[0]&&i.label<o[1]){i.label=o[1],o=s;break}if(o&&i.label<o[2]){i.label=o[2],i.ops.push(s);break}o[2]&&i.ops.pop(),i.trys.pop();continue}s=t.call(e,i)}catch(e){s=[6,e],r=0}finally{n=o=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,l])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.addGetAiMovedFenHandler=void 0;var i=n(870),s=n(779),l=n(994),c=n(983),u=n(208),f=n(662);t.addGetAiMovedFenHandler=function(e){return e.on("getAiMovedFen",(function(t){var n=t.fen,d=t.lmf,h=t.lmt,g=t.gameId,v=t.moveIndex,p=t.engineConfig;return o(void 0,void 0,void 0,(function(){var t,b,m,y,k,M,w,P,x,O,_,j,S,H;return a(this,(function(A){switch(A.label){case 0:return t=null,b=setTimeout((function(){return o(void 0,void 0,void 0,(function(){return a(this,(function(n){switch(n.label){case 0:return[4,e.do("addStatusMessage",{children:'Please wait <div class="spinner"></div>'})];case 1:return t=n.sent(),[2]}}))}))}),1e3),m=(0,u.fen2intArray)(n),[4,(0,f.getDbUpdate)()];case 1:return y=A.sent(),[4,fetch(self.CHSS_config.urls.lambdaAi,{method:"POST",headers:{"Content-Type":"application/json","Access-Control-Allow-Origin":"https://mikilukasik.github.io"},body:JSON.stringify({command:"getMove",data:{fen:n,lmf:d,lmt:h,gameId:g,moveIndex:v,engineConfig:p,dbUpdate:y}})})];case 2:return[4,A.sent().json()];case 3:return k=A.sent(),M=k.winningMoveString,w=k.updateResult,P=k.moveUpdateId,clearTimeout(b),t&&e.do("removeStatusMessage",t),[4,(0,f.processDbUpdateResult)({dbUpdate:y,updateResult:w})];case 4:return A.sent(),x=(0,l.moveString2move)(M),O=(0,i.getMovedBoard)(x,m),_=(0,s.getMovedLmfLmt)({lmf:d,lmt:h,move:x}),j=_.lmf,S=_.lmt,H=(0,c.board2fen)(O),[2,{apiResponse:r(r({},k),{fen:n}),fen:H,lmf:j,lmt:S,move:x,moveUpdateId:P}]}}))}))}))}},753:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addGetMovedFenHandler=void 0;var r=n(870),o=n(779),a=n(994),i=n(983),s=n(208);t.addGetMovedFenHandler=function(e){return e.on("getMovedFen",(function(e){var t=e.fen,n=e.moveString,l=e.lmf,c=e.lmt,u=(0,a.moveString2move)(n),f=(0,r.getMovedBoard)(u,(0,s.fen2intArray)(t)),d=(0,o.getMovedLmfLmt)({lmf:l,lmt:c,move:u}),h=d.lmf,g=d.lmt;return{fen:(0,i.board2fen)(f),lmf:h,lmt:g}}))}},235:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addGetNextMovesHandler=void 0;var r=n(208),o=n(551),a=n(519),i=n(696);t.addGetNextMovesHandler=function(e){return e.on("getNextMoves",(function(e){var t=e.fen,n=(0,r.fen2intArray)(t),s=(0,a.generateLegalMoves)(n);return s.length?{nextMoves:Array.from(s).map(o.move2moveString),gameEnded:!1}:(0,i.isCheck)(n)?{nextMoves:[],gameEnded:!0,result:n[64]?-1:1}:{nextMoves:[],gameEnded:!0,result:0}}))}},469:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.addMainWorkerHandlers=void 0;var r=n(763),o=n(753),a=n(235);t.addMainWorkerHandlers=function(e){(0,o.addGetMovedFenHandler)(e),(0,r.addGetAiMovedFenHandler)(e),(0,a.addGetNextMovesHandler)(e)}},498:(e,t,n)=>{Object.defineProperty(t,"__esModule",{value:!0}),t.initWorkerApi=t.workerClientApi=void 0;var r=n(255),o=n(890),a=n(469);t.workerClientApi=new r.WorkerApi,t.initWorkerApi=function(){(0,a.addMainWorkerHandlers)(t.workerClientApi),(0,o.catchErrors)({logger:function(e){return t.workerClientApi.do("dealWithError",e).catch(console.error)}})}},519:(e,t,n)=>{n.r(t),n.d(t,{generateLegalMoves:()=>i});var r=n(870),o=n(654);const a=[null,(e,t,n)=>{const r=[],o=e>>>3,a=7&e,i=a<7,s=a>0;if(n){const n=e-8;if(0===t[n]&&(1===o?(r[r.length]=n+832,r[r.length]=n+768,r[r.length]=n+704,r[r.length]=n+640):r[r.length]=n,6===o)){const n=e-16;0===t[n]&&(r[r.length]=n)}if(i){const n=e-7;0===t[n]?3===o&&t[66]===n&&(r[r.length]=n):t[n]>>>3==0&&(1===o?(r[r.length]=n+832,r[r.length]=n+768,r[r.length]=n+704,r[r.length]=n+640):r[r.length]=n)}if(s){const n=e-9;0===t[n]?3===o&&t[66]===n&&(r[r.length]=n):t[n]>>>3==0&&(1===o?(r[r.length]=n+832,r[r.length]=n+768,r[r.length]=n+704,r[r.length]=n+640):r[r.length]=n)}return r}const l=e+8;if(0===t[l]&&(6===o?(r[r.length]=l+320,r[r.length]=l+256,r[r.length]=l+192,r[r.length]=l+128):r[r.length]=l,1===o)){const n=e+16;0===t[n]&&(r[r.length]=n)}if(i){const n=e+9;0===t[n]?4===o&&t[66]===n&&(r[r.length]=n):t[n]>>>3==1&&(6===o?(r[r.length]=n+320,r[r.length]=n+256,r[r.length]=n+192,r[r.length]=n+128):r[r.length]=n)}if(s){const n=e+7;0===t[n]?4===o&&t[66]===n&&(r[r.length]=n):t[n]>>>3==1&&(6===o?(r[r.length]=n+320,r[r.length]=n+256,r[r.length]=n+192,r[r.length]=n+128):r[r.length]=n)}return r},(e,t,n)=>{const r=[],o=e>>>3,a=7&e,i=7-o,s=7-a,l=e-9*Math.min(o,a);for(let o=e-9;o>=l;o-=9){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const c=e-7*Math.min(o,s);for(let o=e-7;o>=c;o-=7){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const u=e+7*Math.min(i,a);for(let o=e+7;o<=u;o+=7){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const f=e+9*Math.min(i,s);for(let o=e+9;o<=f;o+=9){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}return r},n(544).P,(e,t,n)=>{const r=[],o=e>>>3,a=7&e,i=7-o,s=7-a,l=e-8*o;for(let o=e-8;o>=l;o-=8){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const c=e+s;for(let o=e+1;o<=c;o+=1){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const u=e+8*i;for(let o=e+8;o<=u;o+=8){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const f=e-a;for(let o=e-1;o>=f;o-=1){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}return r},(e,t,n)=>{const r=[],o=e>>>3,a=7&e,i=7-o,s=7-a,l=e-9*Math.min(o,a);for(let o=e-9;o>=l;o-=9){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const c=e-7*Math.min(o,s);for(let o=e-7;o>=c;o-=7){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const u=e+7*Math.min(i,a);for(let o=e+7;o<=u;o+=7){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const f=e+9*Math.min(i,s);for(let o=e+9;o<=f;o+=9){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const d=e-8*o;for(let o=e-8;o>=d;o-=8){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const h=e+s;for(let o=e+1;o<=h;o+=1){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const g=e+8*i;for(let o=e+8;o<=g;o+=8){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}const v=e-a;for(let o=e-1;o>=v;o-=1){if(0!==t[o]){t[o]>>>3!==n&&(r[r.length]=o);break}r[r.length]=o}return r},(e,t)=>{const n=[],r=t[e]>>>3,a=e>>>3,i=7&e,s=a<7,l=i>0,c=i<7;if(a>0){const o=e-8;if(0!==t[o]&&t[o]>>>3===r||(n[n.length]=o),l){const o=e-9;0!==t[o]&&t[o]>>>3===r||(n[n.length]=o)}if(c){const o=e-7;0!==t[o]&&t[o]>>>3===r||(n[n.length]=o)}}if(s){const o=e+8;if(0!==t[o]&&t[o]>>>3===r||(n[n.length]=o),l){const o=e+7;0!==t[o]&&t[o]>>>3===r||(n[n.length]=o)}if(c){const o=e+9;0!==t[o]&&t[o]>>>3===r||(n[n.length]=o)}}if(l){const o=e-1;0!==t[o]&&t[o]>>>3===r||(n[n.length]=o)}if(c){const o=e+1;0!==t[o]&&t[o]>>>3===r||(n[n.length]=o)}if(0===t[65])return n;if(r){if((0,o.M)(t,60,1))return n;8!=(8&t[65])||0!==t[61]||0!==t[62]||(0,o.M)(t,61,1)||(n[n.length]=62),4!=(4&t[65])||0!==t[59]||0!==t[58]||0!==t[57]||(0,o.M)(t,59,1)||(n[n.length]=58)}else{if((0,o.M)(t,4,0))return n;2!=(2&t[65])||0!==t[5]||0!==t[6]||(0,o.M)(t,5,0)||(n[n.length]=6),1!=(1&t[65])||0!==t[3]||0!==t[1]||0!==t[2]||(0,o.M)(t,3,0)||(n[n.length]=2)}return n}],i=e=>{const t=(e=>{const t=[],n=[],r=e[64];for(let o=63;o>=0;o-=1){if(0===e[o]||e[o]>>>3!==r)continue;const i=a[7&e[o]](o,e,r);if(!i.length)continue;const s=o<<10;for(const r of i)e[63&r]>0?n[n.length]=s+r:t[t.length]=s+r}return 0===n.length?t:[...n,...t]})(e),n=t.filter((t=>{const n=(0,r.getMovedBoard)(t,e);return!(0,o.M)(n,n.indexOf(6+(e[64]<<3)),e[64])}));return new Uint16Array(n)}},544:(e,t,n)=>{n.d(t,{P:()=>r});const r=(e,t,n)=>{const r=[],o=e>>>3,a=7&e,i=a>1,s=i||a>0,l=a<6,c=l||a<7,u=o>1,f=u||o>0,d=o<6,h=d||o<7;if(u){if(s){const o=e-17;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}if(c){const o=e-15;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}}if(d){if(s){const o=e+15;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}if(c){const o=e+17;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}}if(i){if(f){const o=e-10;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}if(h){const o=e+6;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}}if(l){if(f){const o=e-6;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}if(h){const o=e+10;0!==t[o]&&t[o]>>>3===n||(r[r.length]=o)}}return r}},983:(e,t,n)=>{n.r(t),n.d(t,{board2fen:()=>i});var r=n(420);const o=["","p","b","n","r","q","k","","","P","B","N","R","Q","K"],a=["-","q","k","kq","Q","Qq","Qk","Qkq","K","Kq","Kk","Kkq","KQ","KQq","KQk","KQkq"],i=e=>{let t="",n=0;return e.slice(0,64).forEach(((e,r)=>{r>0&&r%8==0&&(n&&(t=`${t}${n}`),t=`${t}/`,n=0),0!==e?(n&&(t=`${t}${n}`,n=0),t=`${t}${o[e]}`):n+=1})),n&&(t=`${t}${n}`),t=`${t} ${e[64]?"w":"b"}`,t=`${t} ${a[e[65]]}`,t=`${t} ${e[66]?(0,r.y)(e[66]):"-"}`,`${t} 0 1`}},420:(e,t,n)=>{n.d(t,{y:()=>r});const r=e=>`${String.fromCharCode(e%8+97)}${8-Math.floor(e/8)}`},208:(e,t,n)=>{n.r(t),n.d(t,{fen2intArray:()=>a});const r=["","p","b","n","r","q","k","","","P","B","N","R","Q","K"],o=["-","q","k","","Q","","","","K"],a=e=>{const[t,n,a,i]=e.split(" "),s=new ArrayBuffer(67),l=new Int8Array(s);let c=0;for(const e of t.split("")){if("/"===e)continue;let t=Number(e);t?c+=t:l[c++]=r.indexOf(e)}return"w"===n&&(l[64]=1),a.split("").forEach((e=>{l[65]+=o.indexOf(e)})),"-"===i||(l[66]=8*(8-(u=i)[1])+(u.charCodeAt(0)-97)),l;var u}},551:(e,t,n)=>{n.r(t),n.d(t,{move2moveString:()=>a});var r=n(420);const o=["",null,"b","n","r","q"],a=e=>`${(0,r.y)(e>>>10)}${(0,r.y)(63&e)}${(e=>o[e>>>6&7])(e)}`},994:(e,t,n)=>{n.r(t),n.d(t,{cellIndex2cellStr:()=>o,cellStr2cellIndex:()=>i,move2moveString:()=>a,moveString2move:()=>s});const r=["",null,"b","n","r","q"],o=e=>`${String.fromCharCode(e%8+97)}${8-Math.floor(e/8)}`,a=e=>`${o(e>>>10)}${o(63&e)}${(e=>r[e>>>6&7])(e)}`,i=e=>(8-Number(e[1])<<3)+(e.charCodeAt(0)-97),s=e=>(8-Number(e[1])<<13)+(e.charCodeAt(0)-97<<10)+(8-Number(e[3])<<3)+(e.charCodeAt(2)-97)+(e[4]?r.indexOf(e[4])<<6:0)},870:(e,t,n)=>{n.r(t),n.d(t,{getMovedBoard:()=>r});const r=(e,t)=>{const n=e>>>10,r=63&e,o=new Int8Array(t);switch(o[r]=o[n],o[n]=0,o[64]=1^t[64],7&t[n]){case 1:t[66]===r&&(o[t[64]?r+8:r-8]=0),o[66]=0,r-n==16&&(o[66]=r-8),n-r==16&&(o[66]=r+8),r>>>3==0&&(o[r]=8+(e>>>6&7)),r>>>3==7&&(o[r]=e>>>6&7);break;case 4:if(o[66]=0,0===t[65])break;63===n&&(o[65]=7&t[65]),56===n&&(o[65]=11&t[65]),7===n&&(o[65]=13&t[65]),0===n&&(o[65]=14&t[65]);break;case 6:if(o[66]=0,0===t[65])break;if(4===n){if(o[65]=12&t[65],2===r){o[3]=4,o[0]=0;break}if(6===r){o[5]=4,o[7]=0;break}}if(60===n){if(o[65]=3&t[65],58===r){o[59]=12,o[56]=0;break}if(62===r){o[61]=12,o[63]=0;break}}break;default:o[66]=0}return 4===t[r]&&(4!==o[0]&&(o[65]=14&o[65]),4!==o[7]&&(o[65]=13&o[65])),12===t[r]&&(12!==o[56]&&(o[65]=11&o[65]),12!==o[63]&&(o[65]=7&o[65])),o}},779:(e,t,n)=>{n.r(t),n.d(t,{getMovedLmfLmt:()=>r});const r=({lmf:e,lmt:t,move:n})=>{const r=63&n;return e[n>>>10]=0,t[r]=0,((e,t)=>{for(let n=0;n<64;n+=1)e[n]=Math.min(e[n]+1,255),t[n]=Math.min(t[n]+1,255)})(e,t),{lmf:e,lmt:t}}},654:(e,t,n)=>{n.d(t,{M:()=>o});var r=n(544);const o=(e,t,n)=>{const o=t>>>3,a=7&t;if(0===n){if(o<6){if(a>0&&9===e[t+7])return!0;if(a<7&&9===e[t+9])return!0}}else if(o>1){if(a<7&&1===e[t-7])return!0;if(a>0&&1===e[t-9])return!0}const i=(0,r.P)(t,e,n);for(const t of i)if(3==(7&e[t]))return!0;const s=7&t,l=7-o,c=7-s,u=(1^n)<<3,f=u+2,d=u+4,h=u+5,g=u+6,v=t-9*Math.min(o,s);for(let n=t-9;n>=v;n-=9)if(0!==e[n]){if(e[n]===f)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t-9)return!0;break}const p=t-7*Math.min(o,c);for(let n=t-7;n>=p;n-=7)if(0!==e[n]){if(e[n]===f)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t-7)return!0;break}const b=t+7*Math.min(l,s);for(let n=t+7;n<=b;n+=7)if(0!==e[n]){if(e[n]===f)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t+7)return!0;break}const m=t+9*Math.min(l,c);for(let n=t+9;n<=m;n+=9)if(0!==e[n]){if(e[n]===f)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t+9)return!0;break}const y=t-8*o;for(let n=t-8;n>=y;n-=8)if(0!==e[n]){if(e[n]===d)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t-8)return!0;break}const k=t+c;for(let n=t+1;n<=k;n+=1)if(0!==e[n]){if(e[n]===d)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t+1)return!0;break}const M=t+8*l;for(let n=t+8;n<=M;n+=8)if(0!==e[n]){if(e[n]===d)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t+8)return!0;break}const w=t-s;for(let n=t-1;n>=w;n-=1)if(0!==e[n]){if(e[n]===d)return!0;if(e[n]===h)return!0;if(e[n]===g&&n===t-1)return!0;break}return!1}},696:(e,t,n)=>{n.r(t),n.d(t,{isCheck:()=>o});var r=n(654);const o=e=>(0,r.M)(e,e.indexOf(6+(e[64]<<3)),e[64])}},n={};function r(e){var o=n[e];if(void 0!==o)return o.exports;var a=n[e]={exports:{}};return t[e].call(a.exports,a,a.exports,r),a.exports}r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),r.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},e=r(498),self.importScripts("config.js"),(0,e.initWorkerApi)()})();